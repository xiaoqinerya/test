import{i as K}from"./index-B3KaCODP.js";import{d as U,m as T,u as F,r as f,a as Y,b as j,o as R,c as N,e as n,f as s,g as b,i as M,j as A,E as V,n as $,k as P,l as q,x as z,y as w,z as H,cX as L,B,$ as W,a0 as O,h as X,aj as G,am as J,cO as Q,P as Z,D as ee,cA as te}from"./index-BiiIy8BH.js";import{i as le}from"./index-CIoy1qQK.js";import{i as ae}from"./index-BQNCTEdX.js";import"./index-DkgahQ27.js";import{i as oe}from"./index-n3iKJaD_.js";import"./index-C6LSuDqi.js";import"./empty-B_ITTikW.js";import"./virtual-list-8KMurCcU.js";import"./index-ZMGHT5nN.js";import"./index-BQkjKN4u.js";import{E as ne}from"./link-B4panqSh.js";import{u as se,a as re,b as ie,l as ue,r as de,c as ce}from"./roleApi-IJr6BXvF.js";import{E as me}from"./tree-BvQcSpbV.js";import"./vuedraggable.umd-CNv-yK7O.js";const pe=U({__name:"role-edit",props:T({data:{}},{modelValue:{type:Boolean},modelModifiers:{}}),emits:T(["done"],["update:modelValue"]),setup(m,{emit:p}){const y=m,d=p,r=F(m,"modelValue"),i=f(!1),o=f(!1),x=f(null),[_,C,D]=Y({roleId:void 0,roleName:"",roleCode:"",comments:""}),S=j({roleName:[{required:!0,message:"请输入角色名称",type:"string",trigger:"blur"}]}),v=()=>{r.value=!1},e=()=>{var l,a;(a=(l=x.value)==null?void 0:l.validate)==null||a.call(l,g=>{if(!g)return;o.value=!0,(i.value?se:re)(_).then(c=>{o.value=!1,V.success(c),v(),d("done")}).catch(c=>{o.value=!1,V.error(c.message)})})},t=()=>{y.data?(D(y.data),i.value=!0):(C(),i.value=!1),$(()=>{$(()=>{var l,a;(a=(l=x.value)==null?void 0:l.clearValidate)==null||a.call(l)})})};return(l,a)=>{const g=P,h=q,c=z,I=w,u=H;return R(),N(u,{form:"",width:460,modelValue:r.value,"onUpdate:modelValue":a[3]||(a[3]=k=>r.value=k),title:i.value?"修改角色":"添加角色",onOpen:t},{footer:n(()=>[s(I,{onClick:v},{default:n(()=>[b("取消")]),_:1}),s(I,{type:"primary",loading:o.value,onClick:e},{default:n(()=>[b(" 保存 ")]),_:1},8,["loading"])]),default:n(()=>[s(c,{ref_key:"formRef",ref:x,model:M(_),rules:S,"label-width":"80px",onSubmit:a[2]||(a[2]=A(()=>{},["prevent"]))},{default:n(()=>[s(h,{label:"角色名称",prop:"roleName"},{default:n(()=>[s(g,{clearable:"",maxlength:20,modelValue:M(_).roleName,"onUpdate:modelValue":a[0]||(a[0]=k=>M(_).roleName=k),placeholder:"请输入角色名称"},null,8,["modelValue"])]),_:1}),s(h,{label:"备注"},{default:n(()=>[s(g,{rows:4,type:"textarea",modelValue:M(_).comments,"onUpdate:modelValue":a[1]||(a[1]=k=>M(_).comments=k),placeholder:"请输入备注"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}}),fe={style:{"vertical-align":"-2px"}},ge=U({components:L,__name:"role-auth",props:T({data:{}},{modelValue:{type:Boolean},modelModifiers:{}}),emits:["update:modelValue"],setup(m){const p=m,y=F(m,"modelValue"),d=f(null),r=f([]),i=f(!1),o=f(!1),x=f([]),_=()=>{r.value=[],x.value=[],p.data&&(i.value=!0,ue(p.data.roleId).then(v=>{i.value=!1,r.value=J({data:v,idField:"menuId",parentIdField:"parentId"}),$(()=>{const e=[];Q(r.value,t=>{var l;t.menuId&&t.checked&&!((l=t.children)!=null&&l.length)&&e.push(t.menuId)}),x.value=e})}).catch(v=>{i.value=!1,V.error(v.message)}))},C=()=>{y.value=!1},D=()=>{var e,t,l,a,g,h,c,I;o.value=!0;const v=(c=((l=(t=(e=d.value)==null?void 0:e.getCheckedKeys)==null?void 0:t.call(e))!=null?l:[]).concat((h=(g=(a=d.value)==null?void 0:a.getHalfCheckedKeys)==null?void 0:g.call(a))!=null?h:[]))!=null?c:[];ie((I=p.data)==null?void 0:I.roleId,v).then(u=>{o.value=!1,V.success(u),C()}).catch(u=>{o.value=!1,V.error(u.message)})},S=()=>{_()};return(v,e)=>{const t=G,l=me,a=oe,g=w,h=H;return R(),N(h,{width:460,title:"分配权限",position:"center",modelValue:y.value,"onUpdate:modelValue":e[0]||(e[0]=c=>y.value=c),"body-style":{padding:"12px 0 12px 22px"},onOpen:S},{footer:n(()=>[s(g,{onClick:C},{default:n(()=>[b("取消")]),_:1}),s(g,{type:"primary",loading:o.value,onClick:D},{default:n(()=>[b(" 保存 ")]),_:1},8,["loading"])]),default:n(()=>[s(a,{loading:i.value,"spinner-style":{background:"transparent"},style:{paddingRight:"20px",height:"calc(100vh - 192px)",maxHeight:"calc(100dvh - 192px)",minHeight:"100px",overflow:"auto"}},{default:n(()=>[s(l,{ref_key:"treeRef",ref:d,"show-checkbox":"",data:r.value,"node-key":"menuId","default-expand-all":!0,props:{label:"title"},"default-checked-keys":x.value,style:{"--ele-tree-item-height":"28px"}},{default:n(c=>[B("div",null,[c.data.icon?(R(),N(t,{key:0,size:16,style:{"margin-right":"6px","vertical-align":"-5px"}},{default:n(()=>[(R(),N(W(c.data.icon)))]),_:2},1024)):O("",!0),B("span",fe,X(c.data.title),1)])]),_:1},8,["data","default-checked-keys"])]),_:1},8,["loading"])]),_:1},8,["modelValue"])}}});function E(m,p=2){return m==null?"":String(m).length>=p?String(m):(Array(p).join("0")+m).slice(-p)}function ve(m,p="yyyy-MM-dd HH:mm:ss"){if(!m)return"";const y=o=>typeof o=="string"?o.includes("T")?o.replace(/\//g,"-"):o.replace(/-/g,"/"):typeof o=="number"&&String(o).length===10?o*1e3:o,d=new Date(y(m)),r=[E(d.getFullYear(),4),E(d.getMonth()+1),E(d.getDate())],i=[E(d.getHours()),E(d.getMinutes()),E(d.getSeconds())];return p.replace(/yyyy/g,r[0]).replace(/MM/g,r[1]).replace(/dd/g,r[2]).replace(/HH/g,i[0]).replace(/mm/g,i[1]).replace(/ss/g,i[2]).replace(/YYYY/g,r[0]).replace(/DD/g,r[2])}const Te=U({name:"SystemRole",__name:"index",setup(m){const p=f(null),y=f([{type:"selection",columnKey:"selection",width:50,align:"center",fixed:"left"},{type:"index",columnKey:"index",width:50,align:"center",fixed:"left"},{prop:"roleName",label:"角色名称",sortable:"custom",minWidth:120},{prop:"comments",label:"备注",sortable:"custom",minWidth:140},{prop:"createTime",label:"创建时间",sortable:"custom",width:180,align:"center",formatter:e=>ve(e.createTime)},{columnKey:"action",label:"操作",width:200,align:"center",slot:"action",hideInPrint:!0,hideInExport:!0}]),d=f([]),r=f(null),i=f(!1),o=f(!1),x=({pages:e})=>(console.log({pages:e}),new Promise((t,l)=>{setTimeout(()=>{t({list:[{userId:1,roleName:"admin",nickname:"管理员"},{userId:2,roleName:"user01",nickname:"用户一"}],count:2})},1500)})),_=e=>{var t,l;d.value=[],(l=(t=p.value)==null?void 0:t.reload)==null||l.call(t,{page:1,where:e})},C=e=>{r.value=e!=null?e:null,i.value=!0},D=e=>{r.value=e!=null?e:null,o.value=!0},S=e=>{ee.confirm("确定要删除“"+e.roleName+"”吗?","系统提示",{type:"warning",draggable:!0}).then(()=>{const t=V.loading({message:"请求中..",plain:!0});de(e.roleId).then(l=>{t.close(),V.success(l),_()}).catch(l=>{t.close(),V.error(l.message)})}).catch(()=>{})},v=({where:e,orders:t})=>ce({...e,...t});return(e,t)=>{const l=w,a=ne,g=te,h=ae,c=le,I=K;return R(),N(I,null,{default:n(()=>[s(c,{"body-style":{paddingTop:"8px"}},{default:n(()=>[s(h,{ref_key:"tableRef",ref:p,"row-key":"roleId",columns:y.value,pagination:!1,datasource:x,border:!0,"show-overflow-tooltip":!0,selections:d.value,"onUpdate:selections":t[1]||(t[1]=u=>d.value=u),"highlight-current-row":!0,"export-config":{fileName:"角色数据",datasource:v},"print-config":{datasource:v},"cache-key":"systemRoleTable"},{toolbar:n(()=>[s(l,{type:"primary",class:"ele-btn-icon",icon:M(Z),onClick:t[0]||(t[0]=u=>C())},{default:n(()=>[b(" 新建 ")]),_:1},8,["icon"])]),action:n(({row:u})=>[s(a,{type:"primary",underline:!1,onClick:k=>C(u)},{default:n(()=>[b(" 修改 ")]),_:2},1032,["onClick"]),s(g,{direction:"vertical"}),u.hasSupper?O("",!0):(R(),N(a,{key:0,type:"primary",underline:!1,onClick:k=>D(u)},{default:n(()=>[b(" 分配权限 ")]),_:2},1032,["onClick"])),s(g,{direction:"vertical"}),s(a,{type:"danger",underline:!1,onClick:k=>S(u)},{default:n(()=>[b(" 删除 ")]),_:2},1032,["onClick"])]),_:1},8,["columns","selections","export-config","print-config"])]),_:1}),s(pe,{modelValue:i.value,"onUpdate:modelValue":t[2]||(t[2]=u=>i.value=u),data:r.value,onDone:_},null,8,["modelValue","data"]),s(ge,{modelValue:o.value,"onUpdate:modelValue":t[3]||(t[3]=u=>o.value=u),data:r.value},null,8,["modelValue","data"])]),_:1})}}});export{Te as default};
