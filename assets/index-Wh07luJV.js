import{i as re}from"./index-B3KaCODP.js";import{d as E,m as O,u as q,r as u,a as Z,b as Q,o as w,c as U,e as i,f as s,g as S,i as C,j as X,E as x,k as G,l as Y,x as ee,y as W,z as J,F as R,B as D,ad as ce,ae as ue,af as me,ag as pe,ah as fe,ai as oe,G as P,D as te,aj as ve,a8 as le,a9 as ae,_ as L,a0 as N,Z as z,ak as H,H as _e,h as A,L as ge,p as ye,al as he,am as be,C as Ve,an as T,ao as ke,a7 as xe,ap as K}from"./index-BiiIy8BH.js";import{i as Ie}from"./index-CIoy1qQK.js";import{i as ne}from"./index-n3iKJaD_.js";import{i as we}from"./index-DkgahQ27.js";import{E as Ce}from"./upload-BGO06KGh.js";import"./progress-CCLXG-1J.js";import{a as De,_ as Fe,r as $e,u as se,b as Ue,l as de,c as Se,d as Ee,e as Oe,i as Be,f as Me}from"./index.vue_vue_type_style_index_0_lang-B8Ks5WcW.js";import{E as Te}from"./empty-B_ITTikW.js";import{E as Ne}from"./tree-BvQcSpbV.js";import"./index-B9kzOIud.js";import"./link-B4panqSh.js";import"./index-C6LSuDqi.js";import"./vuedraggable.umd-CNv-yK7O.js";import"./throttle-DiptQJvM.js";import"./tree-select-B4mwEyeh.js";import"./message-box-D2dYDAIw.js";const Re=E({__name:"folder-edit",props:O({parentId:{}},{modelValue:{type:Boolean},modelModifiers:{}}),emits:O(["done"],["update:modelValue"]),setup(f,{emit:I}){const c=f,_=I,p=q(f,"modelValue"),m=u(null),r=u(!1),[n,h]=Z({name:""}),v=Q({name:[{required:!0,message:"请输入文件夹名称",type:"string",trigger:"blur"}]}),g=()=>{p.value=!1},b=()=>{var y,t;(t=(y=m.value)==null?void 0:y.validate)==null||t.call(y,a=>{a&&(r.value=!0,De({...n,parentId:c.parentId,isDirectory:1}).then(e=>{r.value=!1,x.success(e),g(),_("done")}).catch(e=>{r.value=!1,x.error(e.message)}))})},F=()=>{var y,t;h(),(t=(y=m.value)==null?void 0:y.clearValidate)==null||t.call(y)};return(y,t)=>{const a=G,e=Y,d=ee,V=W,$=J;return w(),U($,{form:"",width:460,title:"新建文件夹",modelValue:p.value,"onUpdate:modelValue":t[2]||(t[2]=o=>p.value=o),onClosed:F},{footer:i(()=>[s(V,{onClick:g},{default:i(()=>[S("取消")]),_:1}),s(V,{type:"primary",loading:r.value,onClick:b},{default:i(()=>[S(" 保存 ")]),_:1},8,["loading"])]),default:i(()=>[s(d,{ref_key:"formRef",ref:m,model:C(n),rules:v,"label-width":"100px",onSubmit:t[1]||(t[1]=X(()=>{},["prevent"]))},{default:i(()=>[s(e,{label:"文件夹名称",prop:"name"},{default:i(()=>[s(a,{clearable:"",maxlength:20,modelValue:C(n).name,"onUpdate:modelValue":t[0]||(t[0]=o=>C(n).name=o),placeholder:"请输入文件夹名称"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])}}}),j=f=>(le("data-v-c02531d6"),f=f(),ae(),f),We=j(()=>D("span",null,"新建",-1)),Le=j(()=>D("span",{class:"hidden-sm-and-down"},"文件夹",-1)),je=j(()=>D("span",{class:"hidden-sm-and-down"},"打开",-1)),ze=j(()=>D("span",null,"文件选择",-1)),Ae={style:{"max-width":"240px"},class:"hidden-sm-and-down"},qe=E({__name:"file-toolbar",props:{grid:{type:Boolean},selections:{},parentId:{}},emits:["update:grid","done"],setup(f,{emit:I}){const c=f,_=I,p=u(""),m=u(!1),r=t=>(t.size/1024/1024>100&&x.error("大小不能超过 100MB"),!1),n=()=>{m.value=!0},h=()=>{const t=c.selections;te.confirm("确定要删除“"+t.map(a=>a.name).join(", ")+"”吗?","系统提示",{type:"warning",draggable:!0}).then(()=>{const a=x.loading({message:"请求中..",plain:!0});$e(t.map(e=>e.id)).then(e=>{a.close(),x.success(e),v()}).catch(e=>{a.close(),x.error(e.message)})}).catch(()=>{})},v=()=>{_("done")},g=()=>{_("update:grid",!c.grid)},b=u(!1),F=()=>{b.value=!0},y=t=>{b.value=!1,t.length&&(console.log(JSON.parse(JSON.stringify(t))),x.success(t.length+"条数据已打印在控制台"))};return(t,a)=>{const e=W,d=Ce,V=G,$=ve,o=we;return w(),R(P,null,[s(o,{theme:"plain",class:"demo-file-toolbar"},{tools:i(()=>[D("div",Ae,[s(V,{modelValue:p.value,"onUpdate:modelValue":a[0]||(a[0]=l=>p.value=l),placeholder:"搜索您的文件","prefix-icon":C(ce)},null,8,["modelValue","prefix-icon"])]),s($,{class:"demo-file-tool",onClick:g},{default:i(()=>[t.grid?(w(),U(C(ue),{key:0})):(w(),U(C(me),{key:1}))]),_:1})]),default:i(()=>[s(d,{action:"","show-file-list":!1,"before-upload":r,style:{display:"inline-block","vertical-align":"middle"}},{default:i(()=>[s(e,{type:"primary",class:"ele-btn-icon",icon:C(pe)},{default:i(()=>[S(" 上传 ")]),_:1},8,["icon"])]),_:1}),s(e,{class:"ele-btn-icon",icon:C(fe),style:{"margin-left":"12px"},onClick:n},{default:i(()=>[We,Le]),_:1},8,["icon"]),s(e,{plain:"",type:"danger",icon:C(oe),disabled:!t.selections.length,class:"ele-btn-icon hidden-xs-only",onClick:h},{default:i(()=>[S(" 删除 ")]),_:1},8,["icon","disabled"]),s(e,{class:"ele-btn-icon",style:{"margin-left":"12px"},onClick:F},{default:i(()=>[je,ze]),_:1})]),_:1}),s(Re,{modelValue:m.value,"onUpdate:modelValue":a[1]||(a[1]=l=>m.value=l),"parent-id":t.parentId,onDone:v},null,8,["modelValue","parent-id"]),s(Fe,{modelValue:b.value,"onUpdate:modelValue":a[2]||(a[2]=l=>b.value=l),onDone:y},null,8,["modelValue"])],64)}}}),Ge=L(qe,[["__scopeId","data-v-c02531d6"]]),Je={class:"demo-breadcrumb"},Pe={class:"demo-breadcrumb-body"},He={class:"demo-breadcrumb-list"},Ke=["onClick"],Ze={class:"hidden-xs-only"},Qe=E({__name:"file-header",props:{directorys:{},total:{}},emits:["update:directorys"],setup(f,{emit:I}){const c=f,_=I,p=()=>{_("update:directorys",c.directorys.slice(0,c.directorys.length-1))},m=()=>{c.directorys.length&&_("update:directorys",[])},r=n=>{n!==c.directorys.length-1&&_("update:directorys",c.directorys.slice(0,n+1))};return(n,h)=>{const v=ge;return w(),R("div",Je,[D("div",Pe,[n.directorys.length?(w(),U(v,{key:0,type:"primary",class:"demo-breadcrumb-back",onClick:p},{default:i(()=>[S(" 返回上一级 ")]),_:1})):N("",!0),D("div",He,[s(v,{type:n.directorys.length?"primary":void 0,class:"demo-breadcrumb-item"},{default:i(()=>[D("div",{class:z({"demo-breadcrumb-link":!!n.directorys.length}),onClick:m}," 全部文件 ",2),n.directorys.length?(w(),U(v,{key:0,icon:C(H),type:"placeholder",style:{display:"flex"}},null,8,["icon"])):N("",!0)]),_:1},8,["type"]),(w(!0),R(P,null,_e(n.directorys,(g,b)=>(w(),U(v,{key:g.id,class:"demo-breadcrumb-item",type:b!==n.directorys.length-1?"primary":"default"},{default:i(()=>[D("div",{class:z({"demo-breadcrumb-link":b!==n.directorys.length-1}),onClick:F=>r(b)},A(g.name),11,Ke),b!==n.directorys.length-1?(w(),U(v,{key:0,icon:C(H),type:"placeholder",style:{display:"flex"}},null,8,["icon"])):N("",!0)]),_:2},1032,["type"]))),128))])]),D("div",Ze,"已全部加载，共 "+A(n.total)+" 个",1)])}}}),Xe=L(Qe,[["__scopeId","data-v-3f58f93f"]]),Ye=E({__name:"name-edit",props:O({data:{}},{modelValue:{type:Boolean},modelModifiers:{}}),emits:O(["done"],["update:modelValue"]),setup(f,{emit:I}){const c=f,_=I,p=q(f,"modelValue"),m=u(null),r=u(!1),[n,h]=Z({name:""}),v=Q({name:[{required:!0,message:"请输入文件/夹名称",type:"string",trigger:"blur"}]}),g=()=>{p.value=!1},b=()=>{var t,a;(a=(t=m.value)==null?void 0:t.validate)==null||a.call(t,e=>{var d;e&&(r.value=!0,se({...n,id:(d=c.data)==null?void 0:d.id}).then(V=>{r.value=!1,x.success(V),g(),_("done")}).catch(V=>{r.value=!1,x.error(V.message)}))})},F=()=>{var t,a;h(),(a=(t=m.value)==null?void 0:t.clearValidate)==null||a.call(t)},y=()=>{c.data&&(n.name=c.data.name)};return(t,a)=>{const e=G,d=Y,V=ee,$=W,o=J;return w(),U(o,{form:"",width:460,title:"重命名",modelValue:p.value,"onUpdate:modelValue":a[2]||(a[2]=l=>p.value=l),onOpen:y,onClosed:F},{footer:i(()=>[s($,{onClick:g},{default:i(()=>[S("取消")]),_:1}),s($,{type:"primary",loading:r.value,onClick:b},{default:i(()=>[S(" 保存 ")]),_:1},8,["loading"])]),default:i(()=>[s(V,{ref_key:"formRef",ref:m,model:C(n),rules:v,"label-width":"100px",onSubmit:a[1]||(a[1]=X(()=>{},["prevent"]))},{default:i(()=>[s(d,{label:"文件/夹名称",prop:"name"},{default:i(()=>[s(e,{clearable:"",maxlength:20,modelValue:C(n).name,"onUpdate:modelValue":a[0]||(a[0]=l=>C(n).name=l),placeholder:"请输入文件/夹名称"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])}}}),eo=f=>(le("data-v-722ec787"),f=f(),ae(),f),oo={class:"demo-file-move-tree"},to=eo(()=>D("img",{src:Ue,style:{width:"18px",height:"18px","margin-right":"6px"}},null,-1)),lo=E({__name:"file-move",props:O({data:{}},{modelValue:{type:Boolean},modelModifiers:{}}),emits:O(["done"],["update:modelValue"]),setup(f,{emit:I}){const c=f,_=I,p=q(f,"modelValue"),m=u(!1),r=u(),n=u([]),h=u(!1),v=t=>{r.value=t.id},g=()=>{p.value=!1},b=()=>{var a;const t=r.value;if(t==null){x.error("请选择分组");return}m.value=!0,se({id:(a=c.data)==null?void 0:a.id,parentId:t}).then(e=>{m.value=!1,x.success(e),g(),_("done")}).catch(e=>{m.value=!1,x.error(e.message)})},F=()=>{h.value=!0,de({isDirectory:1}).then(t=>{const a=[{id:0,name:"未分组"},...he(be({data:t,idField:"id",parentIdField:"parentId"}),e=>{var d;return e.id===((d=c.data)==null?void 0:d.id)?void 0:e})];n.value=a,h.value=!1}).catch(t=>{n.value=[],x.error(t.message),h.value=!1})},y=()=>{F(),c.data&&(r.value=c.data.parentId)};return(t,a)=>{const e=ye,d=Ne,V=ne,$=W,o=J;return w(),U(o,{width:460,title:"移动到",modelValue:p.value,"onUpdate:modelValue":a[0]||(a[0]=l=>p.value=l),onOpen:y},{footer:i(()=>[s($,{onClick:g},{default:i(()=>[S("取消")]),_:1}),s($,{type:"primary",loading:m.value,onClick:b},{default:i(()=>[S(" 保存 ")]),_:1},8,["loading"])]),default:i(()=>[D("div",oo,[s(d,{data:n.value,nodeKey:"id",props:{label:"name"},"expand-on-click-node":!1,"default-expand-all":!0,onNodeClick:v},{default:i(l=>[to,D("span",{class:z(["el-tree-node__label",{"is-active":l.data.id===r.value}])},A(l.data.name),3),s(e,{value:!0,"model-value":l.data.id===r.value},null,8,["model-value"])]),_:1},8,["data"])]),h.value?(w(),U(V,{key:0,loading:h.value,style:{position:"absolute",top:0,left:0,right:0,bottom:0,borderRadius:"var(--el-border-radius-base)",overflow:"hidden"}},null,8,["loading"])):N("",!0)]),_:1},8,["modelValue"])}}}),ao=L(lo,[["__scopeId","data-v-722ec787"]]),no={class:"demo-file-list"},so={key:0,class:"demo-file-list-empty"},io=E({__name:"file-list",props:{parentId:{},data:{},sort:{},order:{},selections:{},grid:{type:Boolean}},emits:["sort-change","update:selections","go-directory","done"],setup(f,{emit:I}){const c=f,_=I,p=u(!1),m=u(),r=u(!1),n=u(),h=u(!1),v=u([]),g=u(0),b=o=>{_("sort-change",o)},F=o=>{_("update:selections",o)},y=o=>{console.log("onItemClick:",JSON.parse(JSON.stringify(o))),o.isDirectory?_("go-directory",o):d(o)?V(o):F(c.selections.includes(o)?c.selections.filter(l=>l!==o):[...c.selections,o])},t=o=>{const{key:l,item:k}=o;l==="open"?k.isDirectory||d(k)?y(k):window.open(k.url):l==="download"?typeof k.downloadUrl=="string"&&window.open(k.downloadUrl):l==="edit"?(m.value=k,p.value=!0):l==="remove"?a(k):l==="move"&&(n.value=k,r.value=!0)},a=o=>{te.confirm(`确定要删除“${o.name}”吗?`,"系统提示",{type:"warning",draggable:!0}).then(()=>{const l=x.loading({message:"请求中..",plain:!0});Oe(o.id).then(k=>{l.close(),x.success(k),e()}).catch(k=>{l.close(),x.error(k.message)})}).catch(()=>{})},e=()=>{_("done")},d=o=>typeof o.contentType=="string"&&o.contentType.startsWith("image/")&&o.url,V=o=>{const l=c.data.filter(B=>d(B)),k=l.indexOf(o);k!==-1&&(v.value=l.map(B=>B.url),g.value=k,h.value=!0)},$=o=>{if(!o)return[];const l=[{title:"重命名",command:"edit",icon:T(ke),divided:!0},{title:"移动到",command:"move",icon:T(xe)},{title:"删除",command:"remove",icon:T(oe),divided:!0,danger:!0}];return o.isDirectory?l.unshift({title:"打开",command:"open"}):d(o)||typeof o.contentType=="string"&&(o.contentType.startsWith("video/")||o.contentType.startsWith("text/")||o.contentType.startsWith("application/pdf")||o.contentType.startsWith("application/json")||o.contentType.startsWith("application/javascript"))?(l[0].divided=!1,l.unshift({title:"下载",command:"download",icon:T(K),divided:!0}),l.unshift({title:"预览",command:"open"})):l.unshift({title:"下载",command:"download",icon:T(K)}),l};return(o,l)=>{const k=Be,B=Te,ie=Me;return w(),R(P,null,[D("div",no,[s(k,{data:o.data,grid:o.grid,sort:o.sort,order:o.order,sortable:!0,"box-choose":!0,"selection-type":"checkbox",selections:o.selections,"context-menus":$,"context-menu-props":{menuStyle:{minWidth:"120px"},iconProps:{size:15},popperOptions:{strategy:"fixed"}},icons:C(Se),"small-icons":C(Ee),style:Ve({minHeight:"400px",minWidth:o.grid?"auto":"456px"}),onItemClick:y,onSortChange:b,"onUpdate:selections":F,onItemContextMenu:t},null,8,["data","grid","sort","order","selections","icons","small-icons","style"]),o.data.length?N("",!0):(w(),R("div",so,[s(B,{description:"无数据","image-size":80})]))]),s(ie,{modelValue:h.value,"onUpdate:modelValue":l[0]||(l[0]=M=>h.value=M),urlList:v.value,initialIndex:g.value,infinite:!1,"hide-on-click-modal":!0},null,8,["modelValue","urlList","initialIndex"]),s(Ye,{modelValue:p.value,"onUpdate:modelValue":l[1]||(l[1]=M=>p.value=M),data:m.value,onDone:e},null,8,["modelValue","data"]),s(ao,{modelValue:r.value,"onUpdate:modelValue":l[2]||(l[2]=M=>r.value=M),data:n.value,onDone:e},null,8,["modelValue","data"])],64)}}}),ro=L(io,[["__scopeId","data-v-35451c23"]]),co={style:{padding:"8px 16px"}},Fo=E({name:"ExtensionFile",__name:"index",setup(f){const I=u(!0),c=u([]),_=u(""),p=u(""),m=u([]),r=u([]),n=u(0),h=u(!0),v=u(0),g=()=>{c.value=[],m.value=[],I.value=!0,de({sort:p.value?_.value:"",order:p.value,parentId:v.value}).then(e=>{I.value=!1,c.value=e.map(d=>Object.assign(d,{key:d.id,isDirectory:d.isDirectory===1,length:a(d.length)})),n.value=e.length}).catch(e=>{I.value=!1,x.error(e.message)})},b=()=>{g()},F=e=>{var d;p.value=(d=e.order)!=null?d:"",_.value=e.sort,g()},y=e=>{t([...r.value,e])},t=e=>{var d,V;r.value=e,v.value=(V=(d=r.value[r.value.length-1])==null?void 0:d.id)!=null?V:0,g()},a=e=>e==null?"-":e<1024?e+"B":e<1024*1024?(e/1024).toFixed(1)+"KB":e<1024*1024*1024?(e/1024/1024).toFixed(1)+"M":(e/1024/1024/1024).toFixed(1)+"G";return g(),(e,d)=>{const V=ne,$=Ie,o=re;return w(),U(o,{"multi-card":!1},{default:i(()=>[s($,{"body-style":{padding:0}},{default:i(()=>[D("div",co,[s(Ge,{grid:h.value,"onUpdate:grid":d[0]||(d[0]=l=>h.value=l),selections:m.value,parentId:v.value,onDone:b},null,8,["grid","selections","parentId"]),s(Xe,{total:n.value,directorys:r.value,"onUpdate:directorys":t},null,8,["total","directorys"])]),s(V,{loading:I.value},{default:i(()=>[s(ro,{grid:h.value,data:c.value,sort:_.value,order:p.value,parentId:v.value,selections:m.value,"onUpdate:selections":d[1]||(d[1]=l=>m.value=l),onSortChange:F,onGoDirectory:y,onDone:b},null,8,["grid","data","sort","order","parentId","selections"])]),_:1},8,["loading"])]),_:1})]),_:1})}}});export{Fo as default};
