import{i as M}from"./index-B3KaCODP.js";import{d as W,a as z,r as V,o as h,c as b,e,f as o,A as D,j as S,i as E,g as p,k as B,l as O,y as C,x as P,s as N,b as $,ap as F,a0 as I,E as R,aa as L,ab as Y,cE as j}from"./index-BiiIy8BH.js";import{i as K}from"./index-CIoy1qQK.js";import{i as U}from"./index-BQNCTEdX.js";import"./index-DkgahQ27.js";import"./index-n3iKJaD_.js";import"./index-C6LSuDqi.js";import"./empty-B_ITTikW.js";import"./virtual-list-8KMurCcU.js";import"./index-ZMGHT5nN.js";import"./index-BQkjKN4u.js";import{E as G,a as A}from"./col-C4RHHrqY.js";import{E as J}from"./date-picker-D5__0yxs.js";import"./vuedraggable.umd-CNv-yK7O.js";import"./index-DwKLMxIz.js";const q=W({__name:"login-record-search",props:{where:{}},emits:["search"],setup(_,{emit:n}){const y=_,T=n,[d,v]=z({username:"",nickname:"",...y.where||{}}),f=V(["",""]),r=()=>{const[s,t]=f.value||[];T("search",{...d,createTimeStart:s?`${s} 00:00:00`:"",createTimeEnd:t?`${t} 23:59:59`:""})},l=()=>{v(),f.value=["",""],r()};return(s,t)=>{const g=B,c=O,i=G,m=J,u=C,a=A,w=P,x=K;return h(),b(x,{"body-style":{paddingBottom:"2px"}},{default:e(()=>[o(w,{"label-width":"72px",onKeyup:D(r,["enter"]),onSubmit:t[3]||(t[3]=S(()=>{},["prevent"]))},{default:e(()=>[o(a,{gutter:8},{default:e(()=>[o(i,{lg:6,md:12,sm:12,xs:24},{default:e(()=>[o(c,{label:"用户账号"},{default:e(()=>[o(g,{clearable:"",modelValue:E(d).username,"onUpdate:modelValue":t[0]||(t[0]=k=>E(d).username=k),modelModifiers:{trim:!0},placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1}),o(i,{lg:6,md:12,sm:12,xs:24},{default:e(()=>[o(c,{label:"用户名"},{default:e(()=>[o(g,{clearable:"",modelValue:E(d).nickname,"onUpdate:modelValue":t[1]||(t[1]=k=>E(d).nickname=k),modelModifiers:{trim:!0},placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1}),o(i,{lg:6,md:12,sm:12,xs:24},{default:e(()=>[o(c,{label:"登录时间"},{default:e(()=>[o(m,{"unlink-panels":"",type:"daterange",modelValue:f.value,"onUpdate:modelValue":t[2]||(t[2]=k=>f.value=k),"range-separator":"-","value-format":"YYYY-MM-DD","start-placeholder":"开始日期","end-placeholder":"结束日期",class:"ele-fluid"},null,8,["modelValue"])]),_:1})]),_:1}),o(i,{lg:6,md:12,sm:12,xs:24},{default:e(()=>[o(c,{"label-width":"16px"},{default:e(()=>[o(u,{type:"primary",onClick:r},{default:e(()=>[p("查询")]),_:1}),o(u,{onClick:l},{default:e(()=>[p("重置")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}});async function H(_){const n=await N.Get("/system/login-record/page",{params:_});return n.code===0?n.data:Promise.reject(new Error(n.message))}async function Q(_){const n=await N.Get("/system/login-record",{params:_});return n.code===0&&n.data?n.data:Promise.reject(new Error(n.message))}const pe=W({name:"SystemLoginRecord",__name:"index",setup(_){const n=$({username:"",nickname:""}),y=V(null),T=V([{type:"index",columnKey:"index",width:50,align:"center",fixed:"left"},{prop:"username",label:"账号",sortable:"custom",minWidth:110},{prop:"nickname",label:"用户名",sortable:"custom",minWidth:110},{prop:"ip",label:"IP地址",sortable:"custom",minWidth:110},{prop:"device",label:"设备型号",sortable:"custom",minWidth:110},{prop:"os",label:"操作系统",sortable:"custom",minWidth:110},{prop:"browser",label:"浏览器",sortable:"custom",minWidth:110},{prop:"loginType",label:"操作类型",sortable:"custom",width:130,slot:"loginType",filters:[{text:"登录成功",value:"0"},{text:"登录失败",value:"1"},{text:"退出登录",value:"2"},{text:"刷新TOKEN",value:"3"}],filterMultiple:!1,align:"center",formatter:r=>["登录成功","登录失败","退出登录","刷新TOKEN"][r.loginType]},{prop:"comments",label:"备注",sortable:"custom",minWidth:110,align:"center"},{prop:"createTime",label:"登录时间",sortable:"custom",width:180,align:"center"}]),d=({pages:r,where:l,orders:s,filters:t})=>H({...l,...s,...t,...r}),v=r=>{var l,s;(s=(l=y.value)==null?void 0:l.reload)==null||s.call(l,{page:1,where:r})},f=()=>{var l,s;const r=R.loading({message:"请求中..",plain:!0});(s=(l=y.value)==null?void 0:l.fetch)==null||s.call(l,({where:t,orders:g,filters:c})=>{Q({...t,...g,...c}).then(i=>{const m=new L.Workbook,u=m.addWorksheet("Sheet1");u.addRow(["账号","用户名","IP地址","设备型号","操作系统","浏览器","操作类型","备注","登录时间"]),i.forEach(a=>{u.addRow([a.username,a.nickname,a.ip,a.device,a.os,a.browser,["登录成功","登录失败","退出登录","刷新TOKEN"][a.loginType],a.comments,a.createTime])}),[16,16,22,22,18,20,14,16,24].forEach((a,w)=>{u.getColumn(w+1).width=a}),u.eachRow({includeEmpty:!0},(a,w)=>{a.height=20,a.eachCell({includeEmpty:!0},x=>{x.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},x.alignment={vertical:"middle",horizontal:"center"},x.font={size:12,bold:w===1}})}),m.xlsx.writeBuffer().then(a=>{Y(a,"登录日志.xlsx"),r.close()})}).catch(i=>{r.close(),R.error(i.message)})})};return(r,l)=>{const s=C,t=j,g=U,c=K,i=M;return h(),b(i,null,{default:e(()=>[o(q,{where:n,onSearch:v},null,8,["where"]),o(c,{"body-style":{paddingTop:"8px"}},{default:e(()=>[o(g,{ref_key:"tableRef",ref:y,"row-key":"id",columns:T.value,datasource:d,"show-overflow-tooltip":!0,"highlight-current-row":!0,"export-config":{fileName:"登录日志数据"},where:n,"cache-key":"systemLoginRecordTable"},{toolbar:e(()=>[o(s,{type:"primary",class:"ele-btn-icon",icon:E(F),onClick:f},{default:e(()=>[p(" 导出 ")]),_:1},8,["icon"])]),loginType:e(({row:m})=>[m.loginType===0?(h(),b(t,{key:0,size:"small",type:"success","disable-transitions":!0},{default:e(()=>[p(" 登录成功 ")]),_:1})):m.loginType===1?(h(),b(t,{key:1,size:"small",type:"danger","disable-transitions":!0},{default:e(()=>[p(" 登录失败 ")]),_:1})):m.loginType===2?(h(),b(t,{key:2,size:"small",type:"info","disable-transitions":!0},{default:e(()=>[p(" 退出登录 ")]),_:1})):m.loginType===3?(h(),b(t,{key:3,size:"small",type:"warning","disable-transitions":!0},{default:e(()=>[p(" 刷新TOKEN ")]),_:1})):I("",!0)]),_:1},8,["columns","where"])]),_:1})]),_:1})}}});export{pe as default};
