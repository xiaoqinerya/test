import{i as _e}from"./index-B3KaCODP.js";import{d as z,a as Q,o as _,c as y,e as l,f as t,A as ye,j as X,i as n,g as b,k as Z,l as ee,y as J,x as te,cX as D,r as U,K as le,cP as ge,am as ne,E as w,a6 as he,$ as B,a0 as S,B as R,h as A,aj as j,m as P,u as oe,cY as $,aN as K,n as Y,p as be,q as ve,cA as ae,cs as Ve,a5 as xe,z as Te,P as Ie,cZ as ke,c_ as Ee,D as Ce,cE as Ue}from"./index-BiiIy8BH.js";import{i as re}from"./index-CIoy1qQK.js";import{i as Me}from"./index-BQNCTEdX.js";import"./index-DkgahQ27.js";import"./index-n3iKJaD_.js";import"./index-C6LSuDqi.js";import"./empty-B_ITTikW.js";import"./virtual-list-8KMurCcU.js";import"./index-ZMGHT5nN.js";import"./index-BQkjKN4u.js";import{E as Ne}from"./link-B4panqSh.js";import{E as se,a as ie}from"./col-C4RHHrqY.js";import{E as $e}from"./input-number-DVnd-AS5.js";import"./tree-BvQcSpbV.js";import{E as Oe}from"./tree-select-B4mwEyeh.js";import{l as de,u as we,a as Fe,r as Se}from"./menuApi-BAL0OvCK.js";import"./index-Dkk57we6.js";import{i as ze}from"./index-BjEEG2RR.js";import"./vuedraggable.umd-CNv-yK7O.js";import"./index-DwKLMxIz.js";const De=z({__name:"menu-search",emits:["search"],setup(M,{emit:v}){const f=v,[g,m]=Q({name:"",path:"",authority:""}),h=()=>{f("search",{...g})},V=()=>{m(),h()};return(p,e)=>{const E=Z,C=ee,k=se,N=J,a=ie,s=te,x=re;return _(),y(x,{"body-style":{paddingBottom:"2px"}},{default:l(()=>[t(s,{"label-width":"72px",onKeyup:ye(h,["enter"]),onSubmit:e[3]||(e[3]=X(()=>{},["prevent"]))},{default:l(()=>[t(a,{gutter:8},{default:l(()=>[t(k,{lg:6,md:12,sm:12,xs:24},{default:l(()=>[t(C,{label:"菜单名称"},{default:l(()=>[t(E,{clearable:"",modelValue:n(g).name,"onUpdate:modelValue":e[0]||(e[0]=T=>n(g).name=T),modelModifiers:{trim:!0},placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1}),t(k,{lg:6,md:12,sm:12,xs:24},{default:l(()=>[t(C,{label:"菜单地址"},{default:l(()=>[t(E,{clearable:"",modelValue:n(g).path,"onUpdate:modelValue":e[1]||(e[1]=T=>n(g).path=T),modelModifiers:{trim:!0},placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1}),t(k,{lg:6,md:12,sm:12,xs:24},{default:l(()=>[t(C,{label:"权限标识"},{default:l(()=>[t(E,{clearable:"",modelValue:n(g).authority,"onUpdate:modelValue":e[2]||(e[2]=T=>n(g).authority=T),modelModifiers:{trim:!0},placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1}),t(k,{lg:6,md:12,sm:12,xs:24},{default:l(()=>[t(C,{"label-width":"16px"},{default:l(()=>[t(N,{type:"primary",onClick:h},{default:l(()=>[b("查询")]),_:1}),t(N,{onClick:V},{default:l(()=>[b("重置")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}}),Be=z({components:D,__name:"menu-select",props:{modelValue:{},placeholder:{default:"请选择上级菜单"}},emits:["update:modelValue"],setup(M,{emit:v}){const f=M,g=v,m=U([]),h=p=>{g("update:modelValue",p||0)},V=le(()=>{var p;if(f.modelValue)return(p=ge(m.value,e=>e.menuId==f.modelValue))==null?void 0:p.icon});return de().then(p=>{m.value=ne({data:p,idField:"menuId",parentIdField:"parentId"})}).catch(p=>{w.error(p.message)}),(p,e)=>{const E=j,C=Oe;return _(),y(C,{clearable:"",filterable:"",data:m.value,"check-strictly":"","default-expand-all":"","node-key":"menuId",props:{label:"title"},placeholder:p.placeholder,"model-value":p.modelValue||void 0,class:"ele-fluid","popper-options":{strategy:"fixed"},"onUpdate:modelValue":h},he({default:l(({data:k})=>[k.icon?(_(),y(E,{key:0,style:{"margin-right":"4px",transform:"translateY(-1px)"}},{default:l(()=>[(_(),y(B(k.icon)))]),_:2},1024)):S("",!0),R("span",null,A(k.title),1)]),_:2},[V.value?{name:"prefix",fn:l(()=>[t(E,{color:"var(--el-text-color-regular)",style:{"margin-right":"6px"}},{default:l(()=>[(_(),y(B(V.value)))]),_:1})]),key:"0"}:void 0]),1032,["data","placeholder","model-value"])}}}),Re=z({components:D,__name:"icon-select",props:P({disabled:{type:Boolean},placeholder:{default:"请选择菜单图标"}},{modelValue:{type:String},modelModifiers:{}}),emits:["update:modelValue"],setup(M){const v=oe(M,"modelValue"),f=Object.keys(D),g=[{title:"线框风格",icons:f.filter(m=>!m.endsWith("Filled"))},{title:"实底风格",icons:f.filter(m=>m.endsWith("Filled"))}];return(m,h)=>{const V=j,p=ze;return _(),y(p,{clearable:"",filterable:"popper",data:g,modelValue:v.value,"onUpdate:modelValue":h[0]||(h[0]=e=>v.value=e),placeholder:m.placeholder,disabled:m.disabled,"popper-width":420,"popper-height":294,"grid-style":{gridTemplateColumns:"repeat(6, 1fr)"},"item-style":{height:"52px"},"popper-options":{strategy:"fixed"}},{icon:l(({icon:e})=>[t(V,null,{default:l(()=>[(_(),y(B(e)))]),_:2},1024)]),_:1},8,["modelValue","placeholder","disabled"])}}}),Ae=z({__name:"menu-edit",props:P({data:{},parentId:{}},{modelValue:{type:Boolean},modelModifiers:{}}),emits:P(["done"],["update:modelValue"]),setup(M,{emit:v}){const f=M,g=v,m=oe(M,"modelValue"),h=U(!1),V=U(!1),p=U(null),[e,E,C]=Q({menuId:void 0,parentId:void 0,name:"",menuType:0,userGroup:0,openType:0,icon:"",path:"",component:"",authority:"",sortNumber:void 0,hide:0,meta:""}),k=le(()=>{const r={title:[{required:!0,type:"string",message:"请输入菜单名称",trigger:"blur"}],sortNumber:[{required:!0,type:"number",message:"请输入排序号",trigger:"blur"}],meta:[{type:"string",validator:(o,i,c)=>{if(i){const d="请输入正确的JSON格式";try{const I=JSON.parse(i);if(I==null||typeof I!="object"){c(d);return}}catch(I){c(d);return}}c()},trigger:"blur"}]};return e.menuType!==2&&(r.path=[{required:!0,type:"string",message:e.openType===2?"请输入外链地址":"请输入路由地址",trigger:"blur"},{type:"string",validator:(o,i,c)=>{if(i)if(e.openType===2){if(!$(i)){c("请输入正确的链接地址");return}}else{if(i==="/"){c("路由地址不能为 /");return}if(!i.startsWith("/")){c("路由地址需要以 / 开头");return}}c()},trigger:"blur"}],e.menuType===1&&e.openType!==2&&(r.component=[{required:!0,type:"string",message:e.openType===1?"请输入内嵌地址":"请输入组件路径",trigger:"blur"},{type:"string",validator:(o,i,c)=>{if(i&&e.openType===1&&!$(i)){c("请输入正确的链接地址");return}c()},trigger:"blur"}])),r}),N=()=>{m.value=!1},a=()=>{var r,o;(o=(r=p.value)==null?void 0:r.validate)==null||o.call(r,i=>{if(!i)return;V.value=!0,(h.value?we:Fe)({...e,menuType:e.menuType===2?1:0,parentId:e.parentId||0}).then(d=>{V.value=!1,w.success(d),N(),g("done")}).catch(d=>{V.value=!1,w.error(d.message)})})},s=()=>{var r,o;e.menuType===0?(e.authority="",e.openType=0,e.component=""):e.menuType===1?e.openType===2&&(e.authority=""):(e.openType=0,e.icon="",e.path="",e.component="",e.hide=0),(o=(r=p.value)==null?void 0:r.clearValidate)==null||o.call(r)},x=()=>{var r,o;e.openType===2&&(e.component="",e.authority=""),(o=(r=p.value)==null?void 0:r.clearValidate)==null||o.call(r)},T=r=>{e.hide=r?0:1},O=r=>{var o;return!!((o=r.children)!=null&&o.length)&&!r.component},F=()=>{if(f.data){const r=$(f.data.path),o=$(f.data.component),i=f.data.menuType===1?2:O(f.data)?0:1;C({...f.data,menuType:i,openType:r?2:o?1:0,parentId:f.data.parentId===0?void 0:f.data.parentId}),h.value=!0}else E(),e.parentId=f.parentId,h.value=!1;Y(()=>{Y(()=>{var r,o;(o=(r=p.value)==null?void 0:r.clearValidate)==null||o.call(r)})})};return(r,o)=>{const i=ee,c=Z,d=se,I=be,G=ve,H=ie,pe=ae,W=j,q=Ve,ue=$e,me=xe,ce=te,L=J,fe=Te;return _(),y(fe,{form:"",width:740,modelValue:m.value,"onUpdate:modelValue":o[11]||(o[11]=u=>m.value=u),title:h.value?"修改菜单":"新建菜单",onOpen:F},{footer:l(()=>[t(L,{onClick:N},{default:l(()=>[b("取消")]),_:1}),t(L,{type:"primary",loading:V.value,onClick:a},{default:l(()=>[b(" 保存 ")]),_:1},8,["loading"])]),default:l(()=>[t(ce,{ref_key:"formRef",ref:p,model:n(e),rules:k.value,"label-width":"100px","validate-on-rule-change":!1,onSubmit:o[10]||(o[10]=X(()=>{},["prevent"]))},{default:l(()=>[t(H,{gutter:16},{default:l(()=>[t(d,{sm:12,xs:24},{default:l(()=>[t(i,{label:"上级菜单",prop:"parentId"},{default:l(()=>[t(Be,{modelValue:n(e).parentId,"onUpdate:modelValue":o[0]||(o[0]=u=>n(e).parentId=u)},null,8,["modelValue"])]),_:1}),t(i,{label:"菜单名称",prop:"name"},{default:l(()=>[t(c,{clearable:"",maxlength:20,modelValue:n(e).name,"onUpdate:modelValue":o[1]||(o[1]=u=>n(e).name=u),placeholder:"请输入菜单名称"},null,8,["modelValue"])]),_:1})]),_:1}),t(d,{sm:12,xs:24},{default:l(()=>[t(i,{label:"菜单类型",prop:"menuType"},{default:l(()=>[t(G,{modelValue:n(e).menuType,"onUpdate:modelValue":o[2]||(o[2]=u=>n(e).menuType=u),onChange:s},{default:l(()=>[t(I,{value:0,label:"目录"}),t(I,{value:1,label:"菜单"}),t(I,{value:2,label:"按钮"})]),_:1},8,["modelValue"])]),_:1}),t(i,{label:"打开方式"},{default:l(()=>[t(G,{modelValue:n(e).openType,"onUpdate:modelValue":o[3]||(o[3]=u=>n(e).openType=u),disabled:n(e).menuType===0||n(e).menuType===2,onChange:x},{default:l(()=>[t(I,{value:0,label:"组件"}),t(I,{value:1,label:"内嵌"}),t(I,{value:2,label:"外链"})]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1}),t(pe,{style:{margin:"8px 0 22px 0",opacity:"0.6"}}),t(H,{gutter:16},{default:l(()=>[t(d,{sm:12,xs:24},{default:l(()=>[t(i,{label:"菜单图标",prop:"icon"},{default:l(()=>[t(Re,{modelValue:n(e).icon,"onUpdate:modelValue":o[4]||(o[4]=u=>n(e).icon=u),disabled:n(e).menuType===2},null,8,["modelValue","disabled"])]),_:1}),t(i,{prop:"path"},{label:l(()=>[n(e).openType===2?(_(),y(q,{key:0,content:"需要以`http://`、`https://`、`//`开头",placement:"top-start","popper-options":{modifiers:[{name:"offset",options:{offset:[-12,10]}}]}},{default:l(()=>[t(W,{size:15,style:{"align-self":"center","margin-right":"4px",cursor:"help"}},{default:l(()=>[t(n(K),{style:{opacity:"0.6"}})]),_:1})]),_:1})):S("",!0),R("span",null,A(n(e).openType===2?"外链地址":"路由地址"),1)]),default:l(()=>[t(c,{clearable:"",maxlength:100,modelValue:n(e).path,"onUpdate:modelValue":o[5]||(o[5]=u=>n(e).path=u),disabled:n(e).menuType===2,placeholder:n(e).openType===2?"请输入外链地址":"请输入路由地址"},null,8,["modelValue","disabled","placeholder"])]),_:1}),t(i,{prop:"component"},{label:l(()=>[n(e).openType===1?(_(),y(q,{key:0,content:"需要以`http://`、`https://`、`//`开头",placement:"top-start","popper-options":{modifiers:[{name:"offset",options:{offset:[-12,10]}}]}},{default:l(()=>[t(W,{size:15,style:{"align-self":"center","margin-right":"4px",cursor:"help"}},{default:l(()=>[t(n(K),{style:{opacity:"0.6"}})]),_:1})]),_:1})):S("",!0),R("span",null,A(n(e).openType===1?"内嵌地址":"组件路径"),1)]),default:l(()=>[t(c,{clearable:"",maxlength:100,modelValue:n(e).component,"onUpdate:modelValue":o[6]||(o[6]=u=>n(e).component=u),disabled:n(e).menuType===0||n(e).menuType===2||n(e).openType===2,placeholder:n(e).openType===1?"请输入内嵌地址":"请输入组件路径"},null,8,["modelValue","disabled","placeholder"])]),_:1})]),_:1}),t(d,{sm:12,xs:24},{default:l(()=>[t(i,{label:"权限标识",prop:"authority"},{default:l(()=>[t(c,{clearable:"",modelValue:n(e).authority,"onUpdate:modelValue":o[7]||(o[7]=u=>n(e).authority=u),placeholder:"请输入权限标识",disabled:n(e).menuType===0||n(e).menuType===1&&n(e).openType===2},null,8,["modelValue","disabled"])]),_:1}),t(i,{label:"排序号",prop:"sortNumber"},{default:l(()=>[t(ue,{min:0,max:99999,modelValue:n(e).sortNumber,"onUpdate:modelValue":o[8]||(o[8]=u=>n(e).sortNumber=u),placeholder:"请输入排序号","controls-position":"right",class:"ele-fluid"},null,8,["modelValue"])]),_:1}),t(i,{label:"是否展示"},{default:l(()=>[t(me,{"inline-prompt":"","active-text":"是","inactive-text":"否","model-value":n(e).hide===0,disabled:n(e).menuType===2,onChange:T},null,8,["model-value","disabled"]),t(q,{content:"选择不展示只注册路由不展示在侧边栏, 比如添加页面应该选择不展示","popper-style":{maxWidth:"240px"}},{default:l(()=>[t(W,{size:15,style:{"margin-left":"16px",cursor:"help"}},{default:l(()=>[t(n(K),{style:{opacity:"0.6"}})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),t(i,{label:"路由元数据",prop:"meta"},{default:l(()=>[t(c,{rows:4,type:"textarea",maxlength:200,modelValue:n(e).meta,"onUpdate:modelValue":o[9]||(o[9]=u=>n(e).meta=u),placeholder:"请输入JSON格式的路由元数据"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}}),it=z({name:"SystemMenu",components:D,__name:"index",setup(M){const v=U(null),f=U([{type:"index",columnKey:"index",width:50,align:"center",fixed:"left"},{prop:"title",label:"菜单名称",slot:"title",minWidth:160},{prop:"path",label:"路由地址",minWidth:160},{prop:"sortNumber",label:"排序",width:100,align:"center"},{prop:"hide",label:"可见",width:100,align:"center",formatter:a=>["是","否"][a.hide]},{prop:"menuType",label:"类型",width:100,align:"center",slot:"menuType",formatter:a=>["菜单","按钮","外链","内嵌","目录"][$(a.path)?2:$(a.component)?3:N(a)?4:a.menuType]},{columnKey:"action",label:"操作",width:180,align:"center",slot:"action",hideInPrint:!0,hideInExport:!0}]),g=U(null),m=U(!1),h=U(),V=async({where:a})=>{const s=await de({...a});return ne({data:s,idField:"menuId",parentIdField:"parentId"})},p=a=>{var s,x;(x=(s=v.value)==null?void 0:s.reload)==null||x.call(s,{where:a})},e=(a,s)=>{g.value=a!=null?a:null,h.value=s,m.value=!0},E=a=>{var s;if((s=a.children)!=null&&s.length){w.error("请先删除子节点");return}Ce.confirm("确定要删除“"+a.title+"”吗?","系统提示",{type:"warning",draggable:!0}).then(()=>{const x=w.loading({message:"请求中..",plain:!0});Se(a.menuId).then(T=>{x.close(),w.success(T),p()}).catch(T=>{x.close(),w.error(T.message)})}).catch(()=>{})},C=()=>{var a,s;(s=(a=v.value)==null?void 0:a.toggleRowExpansionAll)==null||s.call(a,!0)},k=()=>{var a,s;(s=(a=v.value)==null?void 0:a.toggleRowExpansionAll)==null||s.call(a,!1)},N=a=>{var s;return!!((s=a.children)!=null&&s.length)&&!a.component};return(a,s)=>{const x=J,T=j,O=Ue,F=Ne,r=ae,o=Me,i=re,c=_e;return _(),y(c,null,{default:l(()=>[t(De,{onSearch:p}),t(i,{"body-style":{paddingTop:"8px"}},{default:l(()=>[t(o,{sticky:"",ref_key:"tableRef",ref:v,"row-key":"menuId",columns:f.value,datasource:V,"show-overflow-tooltip":!0,"highlight-current-row":!0,"export-config":{fileName:"菜单数据"},"default-expand-all":!1,pagination:!1,"cache-key":"systemMenuTable"},{toolbar:l(()=>[t(x,{type:"primary",class:"ele-btn-icon",icon:n(Ie),onClick:s[0]||(s[0]=d=>e())},{default:l(()=>[b(" 新建 ")]),_:1},8,["icon"]),t(x,{class:"ele-btn-icon",icon:n(ke),onClick:C},{default:l(()=>[b(" 展开全部 ")]),_:1},8,["icon"]),t(x,{class:"ele-btn-icon",icon:n(Ee),onClick:k},{default:l(()=>[b(" 折叠全部 ")]),_:1},8,["icon"])]),title:l(({row:d})=>[d.icon?(_(),y(T,{key:0,size:15,style:{"margin-right":"8px","vertical-align":"-2px"}},{default:l(()=>[(_(),y(B(d.icon)))]),_:2},1024)):S("",!0),R("span",null,A(d.title),1)]),menuType:l(({row:d})=>[n($)(d.path)?(_(),y(O,{key:0,size:"small",type:"danger","disable-transitions":!0},{default:l(()=>[b(" 外链 ")]),_:1})):n($)(d.component)?(_(),y(O,{key:1,size:"small",type:"warning","disable-transitions":!0},{default:l(()=>[b(" 内嵌 ")]),_:1})):N(d)?(_(),y(O,{key:2,size:"small","disable-transitions":!0},{default:l(()=>[b(" 目录 ")]),_:1})):d.menuType===0?(_(),y(O,{key:3,size:"small",type:"success","disable-transitions":!0},{default:l(()=>[b(" 菜单 ")]),_:1})):d.menuType===1?(_(),y(O,{key:4,size:"small",type:"info","disable-transitions":!0},{default:l(()=>[b(" 按钮 ")]),_:1})):S("",!0)]),action:l(({row:d})=>[t(F,{type:"primary",underline:!1,onClick:I=>e(null,d.menuId)},{default:l(()=>[b(" 添加 ")]),_:2},1032,["onClick"]),t(r,{direction:"vertical"}),t(F,{type:"primary",underline:!1,onClick:I=>e(d)},{default:l(()=>[b(" 修改 ")]),_:2},1032,["onClick"]),t(r,{direction:"vertical"}),t(F,{type:"danger",underline:!1,onClick:I=>E(d)},{default:l(()=>[b(" 删除 ")]),_:2},1032,["onClick"])]),_:1},8,["columns"])]),_:1}),t(Ae,{modelValue:m.value,"onUpdate:modelValue":s[1]||(s[1]=d=>m.value=d),data:g.value,"parent-id":h.value,onDone:p},null,8,["modelValue","data","parent-id"])]),_:1})}}});export{it as default};
