import{i as se}from"./index-B3KaCODP.js";import{d as C,b8 as q,d0 as oe,d1 as U,X as H,M as K,bL as I,d2 as ne,W as O,bv as re,i as _,o as c,F as $,B as E,G as M,H as F,c as N,f as a,a1 as G,bw as ie,bN as de,aX as ce,a$ as ue,K as pe,Z as R,Y,g as D,h as k,a0 as B,b1 as me,a2 as fe,bb as _e,a as be,r as W,e,A as he,j as ye,k as ge,l as ve,y as L,x as we,m as ke,u as Ee,b as Se,bs as Ne,cE as X,z as xe,_ as De,s as J,ap as Ve,E as j,aa as $e,ab as Te}from"./index-BiiIy8BH.js";import{i as Z}from"./index-CIoy1qQK.js";import{i as Ce}from"./index-BQNCTEdX.js";import"./index-DkgahQ27.js";import"./index-n3iKJaD_.js";import"./index-C6LSuDqi.js";import"./empty-B_ITTikW.js";import"./virtual-list-8KMurCcU.js";import"./index-ZMGHT5nN.js";import"./index-BQkjKN4u.js";import{E as ze}from"./link-B4panqSh.js";import{E as Me,a as Re}from"./col-C4RHHrqY.js";import{E as Ie}from"./date-picker-D5__0yxs.js";import{i as Pe}from"./index-BTn_n3us.js";import"./vuedraggable.umd-CNv-yK7O.js";import"./index-DwKLMxIz.js";const A=Symbol("elDescriptions");var P=C({name:"ElDescriptionsCell",props:{cell:{type:Object},tag:{type:String,default:"td"},type:{type:String}},setup(){return{descriptions:q(A,{})}},render(){var S,r,u,w,t,p,d;const m=oe(this.cell),n=(((S=this.cell)==null?void 0:S.dirs)||[]).map(z=>{const{dir:ee,arg:te,modifiers:le,value:ae}=z;return[ee,ae,te,le]}),{border:l,direction:o}=this.descriptions,s=o==="vertical",b=((w=(u=(r=this.cell)==null?void 0:r.children)==null?void 0:u.label)==null?void 0:w.call(u))||m.label,v=(d=(p=(t=this.cell)==null?void 0:t.children)==null?void 0:p.default)==null?void 0:d.call(p),f=m.span,y=m.rowspan,x=m.align?`is-${m.align}`:"",g=m.labelAlign?`is-${m.labelAlign}`:x,i=m.className,V=m.labelClassName,T={width:U(m.width),minWidth:U(m.minWidth)},h=H("descriptions");switch(this.type){case"label":return K(I(this.tag,{style:T,class:[h.e("cell"),h.e("label"),h.is("bordered-label",l),h.is("vertical-label",s),g,V],colSpan:s?f:1,rowspan:s?1:y},b),n);case"content":return K(I(this.tag,{style:T,class:[h.e("cell"),h.e("content"),h.is("bordered-content",l),h.is("vertical-content",s),x,i],colSpan:s?f:f*2-1,rowspan:s?y*2-1:y},v),n);default:return K(I("td",{style:T,class:[h.e("cell"),x],colSpan:f,rowspan:y},[ne(b)?void 0:I("span",{class:[h.e("label"),V]},b),I("span",{class:[h.e("content"),i]},v)]),n)}}});const We=O({row:{type:re(Array),default:()=>[]}}),Be=C({name:"ElDescriptionsRow"}),Fe=C({...Be,props:We,setup(S){const r=q(A,{});return(u,w)=>_(r).direction==="vertical"?(c(),$(M,{key:0},[E("tr",null,[(c(!0),$(M,null,F(u.row,(t,p)=>(c(),N(_(P),{key:`tr1-${p}`,cell:t,tag:"th",type:"label"},null,8,["cell"]))),128))]),E("tr",null,[(c(!0),$(M,null,F(u.row,(t,p)=>(c(),N(_(P),{key:`tr2-${p}`,cell:t,tag:"td",type:"content"},null,8,["cell"]))),128))])],64)):(c(),$("tr",{key:1},[(c(!0),$(M,null,F(u.row,(t,p)=>(c(),$(M,{key:`tr3-${p}`},[_(r).border?(c(),$(M,{key:0},[a(_(P),{cell:t,tag:"td",type:"label"},null,8,["cell"]),a(_(P),{cell:t,tag:"td",type:"content"},null,8,["cell"])],64)):(c(),N(_(P),{key:1,cell:t,tag:"td",type:"both"},null,8,["cell"]))],64))),128))]))}});var Ke=G(Fe,[["__file","descriptions-row.vue"]]);const Oe=O({border:Boolean,column:{type:Number,default:3},direction:{type:String,values:["horizontal","vertical"],default:"horizontal"},size:ie,title:{type:String,default:""},extra:{type:String,default:""}}),Ae=C({name:"ElDescriptions"}),Ue=C({...Ae,props:Oe,setup(S){const r=S,u=H("descriptions"),w=de(),t=ce();ue(A,r);const p=pe(()=>[u.b(),u.m(w.value)]),d=(n,l,o,s=!1)=>(n.props||(n.props={}),l>o&&(n.props.span=o),s&&(n.props.span=l),n),m=()=>{if(!t.default)return[];const n=me(t.default()).filter(f=>{var y;return((y=f==null?void 0:f.type)==null?void 0:y.name)==="ElDescriptionsItem"}),l=[];let o=[],s=r.column,b=0;const v=[];return n.forEach((f,y)=>{var x,g,i;const V=((x=f.props)==null?void 0:x.span)||1,T=((g=f.props)==null?void 0:g.rowspan)||1,h=l.length;if(v[h]||(v[h]=0),T>1)for(let z=1;z<T;z++)v[i=h+z]||(v[i]=0),v[h+z]++,b++;if(v[h]>0&&(s-=v[h],v[h]=0),y<n.length-1&&(b+=V>s?s:V),y===n.length-1){const z=r.column-b%r.column;o.push(d(f,z,s,!0)),l.push(o);return}V<s?(s-=V,o.push(f)):(o.push(d(f,V,s)),l.push(o),s=r.column,o=[])}),l};return(n,l)=>(c(),$("div",{class:R(_(p))},[n.title||n.extra||n.$slots.title||n.$slots.extra?(c(),$("div",{key:0,class:R(_(u).e("header"))},[E("div",{class:R(_(u).e("title"))},[Y(n.$slots,"title",{},()=>[D(k(n.title),1)])],2),E("div",{class:R(_(u).e("extra"))},[Y(n.$slots,"extra",{},()=>[D(k(n.extra),1)])],2)],2)):B("v-if",!0),E("div",{class:R(_(u).e("body"))},[E("table",{class:R([_(u).e("table"),_(u).is("bordered",n.border)])},[E("tbody",null,[(c(!0),$(M,null,F(m(),(o,s)=>(c(),N(Ke,{key:s,row:o},null,8,["row"]))),128))])],2)],2)],2))}});var Ye=G(Ue,[["__file","description.vue"]]);const je=O({label:{type:String,default:""},span:{type:Number,default:1},rowspan:{type:Number,default:1},width:{type:[String,Number],default:""},minWidth:{type:[String,Number],default:""},align:{type:String,default:"left"},labelAlign:{type:String,default:""},className:{type:String,default:""},labelClassName:{type:String,default:""}}),Q=C({name:"ElDescriptionsItem",props:je}),qe=fe(Ye,{DescriptionsItem:Q}),He=_e(Q),Ge=C({__name:"operation-record-search",emits:["search"],setup(S,{emit:r}){const u=r,[w,t]=be({username:"",module:""}),p=W(["",""]),d=()=>{const[n,l]=p.value||[];u("search",{...w,createTimeStart:n,createTimeEnd:l})},m=()=>{t(),p.value=["",""],d()};return(n,l)=>{const o=ge,s=ve,b=Me,v=Ie,f=L,y=Re,x=we,g=Z;return c(),N(g,{"body-style":{paddingBottom:"2px"}},{default:e(()=>[a(x,{"label-width":"72px",onKeyup:he(d,["enter"]),onSubmit:l[3]||(l[3]=ye(()=>{},["prevent"]))},{default:e(()=>[a(y,{gutter:8},{default:e(()=>[a(b,{lg:6,md:12,sm:12,xs:24},{default:e(()=>[a(s,{label:"用户账号"},{default:e(()=>[a(o,{clearable:"",modelValue:_(w).username,"onUpdate:modelValue":l[0]||(l[0]=i=>_(w).username=i),modelModifiers:{trim:!0},placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1}),a(b,{lg:6,md:12,sm:12,xs:24},{default:e(()=>[a(s,{label:"操作模块"},{default:e(()=>[a(o,{clearable:"",modelValue:_(w).module,"onUpdate:modelValue":l[1]||(l[1]=i=>_(w).module=i),modelModifiers:{trim:!0},placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1}),a(b,{lg:6,md:12,sm:12,xs:24},{default:e(()=>[a(s,{label:"操作时间"},{default:e(()=>[a(v,{"unlink-panels":"",type:"datetimerange",modelValue:p.value,"onUpdate:modelValue":l[2]||(l[2]=i=>p.value=i),"range-separator":"-","value-format":"YYYY-MM-DD HH:mm:ss","start-placeholder":"开始时间","end-placeholder":"结束时间",class:"ele-fluid"},null,8,["modelValue"])]),_:1})]),_:1}),a(b,{lg:6,md:12,sm:12,xs:24},{default:e(()=>[a(s,{"label-width":"16px"},{default:e(()=>[a(f,{type:"primary",onClick:d},{default:e(()=>[D("查询")]),_:1}),a(f,{onClick:m},{default:e(()=>[D("重置")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}}),Le={key:0},Xe={style:{"word-break":"break-all"}},Je={style:{"word-break":"break-all"}},Ze=C({__name:"operation-record-detail",props:ke({data:{}},{modelValue:{type:Boolean},modelModifiers:{}}),emits:["update:modelValue"],setup(S){const r=Ee(S,"modelValue"),u=Se({popperStyle:{width:"580px",maxWidth:"90%",wordBreak:"break-all"},bodyStyle:{maxWidth:"calc(100vw - 32px)",maxHeight:"252px",overflowY:"auto","--ele-scrollbar-color":"#5e5e5e","--ele-scrollbar-hover-color":"#707070","--ele-scrollbar-size":"8px"},offset:4,placement:"top"}),{mobile:w}=Ne();return(t,p)=>{const d=He,m=X,n=Pe,l=qe,o=xe;return c(),N(o,{title:"详情",width:720,modelValue:r.value,"onUpdate:modelValue":p[0]||(p[0]=s=>r.value=s)},{default:e(()=>[t.data?(c(),N(l,{key:0,border:!0,column:_(w)?1:2,class:"detail-table"},{default:e(()=>[a(d,{label:"操作人"},{default:e(()=>[E("div",null,k(t.data.nickname)+"("+k(t.data.username)+")",1)]),_:1}),a(d,{label:"IP地址"},{default:e(()=>[E("div",null,k(t.data.ip),1)]),_:1}),a(d,{label:"操作模块"},{default:e(()=>[E("div",null,k(t.data.module),1)]),_:1}),a(d,{label:"操作功能"},{default:e(()=>[E("div",null,k(t.data.description),1)]),_:1}),a(d,{label:"操作时间"},{default:e(()=>[E("div",null,k(t.data.createTime),1)]),_:1}),a(d,{label:"请求耗时"},{default:e(()=>[isNaN(t.data.spendTime)?B("",!0):(c(),$("div",Le,k(t.data.spendTime/1e3)+"s",1))]),_:1}),a(d,{label:"请求方式"},{default:e(()=>[E("div",null,k(t.data.requestMethod),1)]),_:1}),a(d,{label:"请求状态"},{default:e(()=>[t.data.status===0?(c(),N(m,{key:0,size:"small",type:"success","disable-transitions":!0},{default:e(()=>[D(" 正常 ")]),_:1})):t.data.status===1?(c(),N(m,{key:1,size:"small",type:"danger","disable-transitions":!0},{default:e(()=>[D(" 异常 ")]),_:1})):B("",!0)]),_:1}),a(d,{label:"请求地址",span:2},{default:e(()=>[E("div",Xe,k(t.data.url),1)]),_:1}),a(d,{label:"调用方法",span:2},{default:e(()=>[E("div",Je,k(t.data.method),1)]),_:1}),a(d,{label:"请求参数",span:2},{default:e(()=>[a(n,{"max-line":4,tooltip:u},{default:e(()=>[D(k(t.data.params),1)]),_:1},8,["tooltip"])]),_:1}),t.data.status===0?(c(),N(d,{key:0,label:"返回结果",span:2},{default:e(()=>[a(n,{"max-line":4,tooltip:u},{default:e(()=>[D(k(t.data.result),1)]),_:1},8,["tooltip"])]),_:1})):(c(),N(d,{key:1,label:"异常信息",span:2},{default:e(()=>[a(n,{"max-line":4,tooltip:u},{default:e(()=>[D(k(t.data.error),1)]),_:1},8,["tooltip"])]),_:1}))]),_:1},8,["column"])):B("",!0)]),_:1},8,["modelValue"])}}}),Qe=De(Ze,[["__scopeId","data-v-18aa4e3a"]]);async function et(S){const r=await J.Get("/system/operation-record/page",{params:S});return r.code===0?r.data:Promise.reject(new Error(r.message))}async function tt(S){const r=await J.Get("/system/operation-record",{params:S});return r.code===0&&r.data?r.data:Promise.reject(new Error(r.message))}const gt=C({name:"SystemOperationRecord",__name:"index",setup(S){const r=W(null),u=W([{type:"index",columnKey:"index",width:50,align:"center",fixed:"left"},{prop:"username",label:"账号",sortable:"custom",minWidth:110},{prop:"nickname",label:"用户名",sortable:"custom",minWidth:110},{prop:"module",label:"操作模块",sortable:"custom",minWidth:110},{prop:"description",label:"操作功能",sortable:"custom",minWidth:110},{prop:"url",label:"请求地址",sortable:"custom",minWidth:110},{prop:"requestMethod",label:"请求方式",sortable:"custom",width:110,align:"center"},{prop:"status",label:"状态",sortable:"custom",width:100,align:"center",slot:"status",filters:[{text:"正常",value:"0"},{text:"异常",value:"1"}],filterMultiple:!1,formatter:l=>l.status==0?"正常":"异常"},{prop:"spendTime",label:"耗时",sortable:"custom",width:100,formatter:l=>`${l.spendTime/1e3}s`,align:"center"},{prop:"createTime",label:"操作时间",sortable:"custom",align:"center",width:180},{columnKey:"action",label:"操作",width:90,align:"center",slot:"action",fixed:"right",hideInPrint:!0,hideInExport:!0}]),w=W({module:"",description:"",url:"",requestMethod:"",method:"",params:"",result:"",error:"",spendTime:0,os:"",device:"",browser:"",ip:"",status:0,createTime:"",nickname:"",username:""}),t=W(!1),p=({pages:l,where:o,orders:s,filters:b})=>et({...o,...s,...b,...l}),d=l=>{var o,s;(s=(o=r.value)==null?void 0:o.reload)==null||s.call(o,{page:1,where:l})},m=l=>{w.value=l,t.value=!0},n=()=>{var o,s;const l=j.loading({message:"请求中..",plain:!0});(s=(o=r.value)==null?void 0:o.fetch)==null||s.call(o,({where:b,orders:v,filters:f})=>{tt({...b,...v,...f}).then(y=>{const x=new $e.Workbook,g=x.addWorksheet("Sheet1");g.addRow(["账号","用户名","操作模块","操作功能","请求地址","请求方式","状态","耗时","操作时间"]),y.forEach(i=>{g.addRow([i.username,i.nickname,i.module,i.description,i.url,i.requestMethod,["正常","异常"][i.status],i.spendTime/1e3+"s",i.createTime])}),[16,16,18,20,28,14,14,14,24].forEach((i,V)=>{g.getColumn(V+1).width=i}),g.eachRow({includeEmpty:!0},(i,V)=>{i.height=20,i.eachCell({includeEmpty:!0},T=>{T.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},T.alignment={vertical:"middle",horizontal:"center"},T.font={size:12,bold:V===1}})}),x.xlsx.writeBuffer().then(i=>{Te(i,"操作日志.xlsx"),l.close()})}).catch(y=>{l.close(),j.error(y.message)})})};return(l,o)=>{const s=L,b=X,v=ze,f=Ce,y=Z,x=se;return c(),N(x,null,{default:e(()=>[a(Ge,{onSearch:d}),a(y,{"body-style":{paddingTop:"8px"}},{default:e(()=>[a(f,{ref_key:"tableRef",ref:r,"row-key":"id",columns:u.value,datasource:p,"show-overflow-tooltip":!0,"highlight-current-row":!0,"export-config":{fileName:"操作日志数据"},"cache-key":"systemOperationRecordTable"},{toolbar:e(()=>[a(s,{type:"primary",class:"ele-btn-icon",icon:_(Ve),onClick:n},{default:e(()=>[D(" 导出 ")]),_:1},8,["icon"])]),status:e(({row:g})=>[g.status===0?(c(),N(b,{key:0,size:"small",type:"success","disable-transitions":!0},{default:e(()=>[D(" 正常 ")]),_:1})):g.status===1?(c(),N(b,{key:1,size:"small",type:"danger","disable-transitions":!0},{default:e(()=>[D(" 异常 ")]),_:1})):B("",!0)]),action:e(({row:g})=>[a(v,{type:"primary",underline:!1,onClick:i=>m(g)},{default:e(()=>[D(" 详情 ")]),_:2},1032,["onClick"])]),_:1},8,["columns"])]),_:1}),a(Qe,{modelValue:t.value,"onUpdate:modelValue":o[0]||(o[0]=g=>t.value=g),data:w.value},null,8,["modelValue","data"])]),_:1})}}});export{gt as default};
