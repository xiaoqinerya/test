import{i as H}from"./index-B3KaCODP.js";import{d as I,v as z,a as A,o as C,c as $,e as a,f as t,i as n,g as h,A as J,j as D,k as G,l as K,y as F,x as W,K as Q,r as b,w as X,F as Y,G as ee,H as te,I as le,J as ae,E as w,m as B,u as oe,b as se,a0 as ne,n as q,p as re,q as ue,z as de,P as O,h as me,D as ie,a5 as pe,cA as ce}from"./index-BiiIy8BH.js";import{i as _e}from"./index-CIoy1qQK.js";import{i as fe}from"./index-BQNCTEdX.js";import"./index-DkgahQ27.js";import"./index-n3iKJaD_.js";import"./index-C6LSuDqi.js";import"./empty-B_ITTikW.js";import"./virtual-list-8KMurCcU.js";import"./index-ZMGHT5nN.js";import"./index-BQkjKN4u.js";import{E as ge}from"./link-B4panqSh.js";import{E as Z,a as j}from"./col-C4RHHrqY.js";import{p as be}from"./roleApi-IJr6BXvF.js";import{c as ve,u as ye,a as Ve,p as P,b as he,d as xe}from"./sysUserApi-BptSlCvq.js";import"./vuedraggable.umd-CNv-yK7O.js";const Ee=/^1\d{10}$/,ke=/^([a-zA-Z0-9_.-])+@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/,we=I({__name:"user-search",emits:["search"],setup(N,{expose:c,emit:v}){const{t:y}=z.useI18n(),V=v,[r,_]=A({account:"",userName:""}),u=()=>{V("search",{...r})},d=()=>{_(),u()};return c({resetFields:_}),(U,p)=>{const g=G,x=K,E=Z,s=F,l=j,e=W;return C(),$(e,{"label-width":"72px",onKeyup:J(u,["enter"]),onSubmit:p[2]||(p[2]=D(()=>{},["prevent"]))},{default:a(()=>[t(l,{gutter:8},{default:a(()=>[t(E,{lg:6,md:12,sm:12,xs:24},{default:a(()=>[t(x,{label:n(y)("system.user.account")},{default:a(()=>[t(g,{clearable:"",modelValue:n(r).account,"onUpdate:modelValue":p[0]||(p[0]=o=>n(r).account=o),modelModifiers:{trim:!0},placeholder:"请输入"},null,8,["modelValue"])]),_:1},8,["label"])]),_:1}),t(E,{lg:6,md:12,sm:12,xs:24},{default:a(()=>[t(x,{label:n(y)("system.user.userName")},{default:a(()=>[t(g,{clearable:"",modelValue:n(r).userName,"onUpdate:modelValue":p[1]||(p[1]=o=>n(r).userName=o),modelModifiers:{trim:!0},placeholder:"请输入"},null,8,["modelValue"])]),_:1},8,["label"])]),_:1}),t(E,{lg:6,md:12,sm:12,xs:24},{default:a(()=>[t(x,{"label-width":"16px"},{default:a(()=>[t(s,{type:"primary",onClick:u},{default:a(()=>[h("查询")]),_:1}),t(s,{onClick:d},{default:a(()=>[h("重置")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}}),Ue=I({__name:"index",props:{userGroup:{},modelValue:{},placeholder:{default:"请选择角色"}},emits:["update:modelValue"],setup(N,{emit:c}){const v=N,y=c,V=Q(()=>v.modelValue),r=b([]),_=u=>{console.log(u),y("update:modelValue",u)};return X(()=>v.userGroup,()=>{be({}).then(u=>{r.value=u,console.log(9999,u)}).catch(u=>{w.error(u.message)})},{immediate:!0}),(u,d)=>{const U=le,p=ae;return C(),$(p,{clearable:"","model-value":V.value,placeholder:u.placeholder,class:"ele-fluid","onUpdate:modelValue":_},{default:a(()=>[(C(!0),Y(ee,null,te(r.value,g=>(C(),$(U,{key:g.roleId,value:g.roleId,label:g.roleName},null,8,["value","label"]))),128))]),_:1},8,["model-value","placeholder"])}}}),Ce=I({__name:"user-edit",props:B({data:{}},{modelValue:{type:Boolean},modelModifiers:{}}),emits:B(["done"],["update:modelValue"]),setup(N,{emit:c}){const v=N,y=c,V=oe(N,"modelValue"),r=b(!1),_=b(!1),u=b(null),[d,U,p]=A({id:void 0,account:"",userName:"",userType:0,phone:"",password:"",admin:"",state:0}),g=se({account:[{required:!0,message:"请输入用户账号",type:"string",trigger:"blur"},{min:4,message:"账号长度最少为4位",type:"string",trigger:"blur"},{type:"string",trigger:"blur",validator:(l,e,o)=>{if(r.value){o();return}ve("account",e).then(()=>{o(new Error("账号已经存在"))}).catch(()=>{o()})}}],userName:[{required:!0,message:"请输入姓名",type:"string",trigger:"blur"}],userType:[{required:!0,message:"请选择角色",type:"number",trigger:"change"}],email:[{pattern:ke,message:"邮箱格式不正确",type:"string",trigger:"blur"}],password:[{required:!0,message:"请输入密码",type:"string",trigger:"blur"},{type:"string",trigger:"blur",validator:(l,e,o)=>{if(r.value||/^[\S]{5,18}$/.test(e))return o();o(new Error("密码必须为5-18位非空白字符"))}}],phone:[{required:!0,message:"请输入手机号",type:"string",trigger:"blur"},{pattern:Ee,message:"手机号格式不正确",type:"string",trigger:"blur"}]}),x=()=>{V.value=!1},E=()=>{var l,e;(e=(l=u.value)==null?void 0:l.validate)==null||e.call(l,o=>{if(!o)return;_.value=!0,(r.value?ye:Ve)(d).then(k=>{_.value=!1,w.success(k),x(),y("done")}).catch(k=>{_.value=!1,w.error(k.message)})})},s=()=>{v.data?(p({...v.data,password:""}),r.value=!0):(U(),r.value=!1),q(()=>{q(()=>{var l,e;(e=(l=u.value)==null?void 0:l.clearValidate)==null||e.call(l)})})};return(l,e)=>{const o=G,f=K,k=re,R=ue,S=Z,M=j,m=W,T=F,L=de;return C(),$(L,{form:"",width:680,modelValue:V.value,"onUpdate:modelValue":e[8]||(e[8]=i=>V.value=i),title:r.value?"修改用户":"新建用户",onOpen:s},{footer:a(()=>[t(T,{onClick:x},{default:a(()=>[h("取消")]),_:1}),t(T,{type:"primary",loading:_.value,onClick:E},{default:a(()=>[h(" 保存 ")]),_:1},8,["loading"])]),default:a(()=>[t(m,{ref_key:"formRef",ref:u,model:n(d),rules:g,"label-width":"80px",onSubmit:e[7]||(e[7]=D(()=>{},["prevent"]))},{default:a(()=>[t(M,{gutter:16},{default:a(()=>[t(S,{sm:24,xs:24},{default:a(()=>[t(f,{label:"用户账号",prop:"account"},{default:a(()=>[t(o,{clearable:"",maxlength:20,modelValue:n(d).account,"onUpdate:modelValue":e[0]||(e[0]=i=>n(d).account=i),placeholder:"请输入用户账号",disabled:r.value},null,8,["modelValue","disabled"])]),_:1}),t(f,{label:"姓名",prop:"userName"},{default:a(()=>[t(o,{clearable:"",maxlength:20,modelValue:n(d).userName,"onUpdate:modelValue":e[1]||(e[1]=i=>n(d).userName=i),placeholder:"请输入姓名"},null,8,["modelValue"])]),_:1}),t(f,{label:"角色",prop:"userType"},{default:a(()=>[t(Ue,{"user-group":0,modelValue:n(d).userType,"onUpdate:modelValue":e[2]||(e[2]=i=>n(d).userType=i)},null,8,["modelValue"])]),_:1}),t(f,{label:"手机号",prop:"phone"},{default:a(()=>[t(o,{clearable:"",maxlength:11,modelValue:n(d).phone,"onUpdate:modelValue":e[3]||(e[3]=i=>n(d).phone=i),placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1}),r.value?ne("",!0):(C(),$(f,{key:0,label:"密码",prop:"password"},{default:a(()=>[t(o,{"show-password":"",type:"password",maxlength:20,modelValue:n(d).password,"onUpdate:modelValue":e[4]||(e[4]=i=>n(d).password=i),placeholder:"请输入密码"},null,8,["modelValue"])]),_:1})),t(f,{label:"状态"},{default:a(()=>[t(R,{modelValue:n(d).state,"onUpdate:modelValue":e[5]||(e[5]=i=>n(d).state=i)},{default:a(()=>[t(k,{value:1,label:"开启"}),t(k,{value:0,label:"关闭"})]),_:1},8,["modelValue"])]),_:1}),t(f,{label:"操作人",prop:"admin"},{default:a(()=>[t(o,{clearable:"",maxlength:20,modelValue:n(d).admin,"onUpdate:modelValue":e[6]||(e[6]=i=>n(d).admin=i),placeholder:"请输入操作人"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}}),Ke=I({__name:"index",setup(N){const{t:c}=z.useI18n(),v=b(null),y=b(null),V=b([{prop:"account",label:c("system.user.account"),sortable:"custom",minWidth:110},{prop:"userName",label:c("system.user.userName"),sortable:"custom",minWidth:110,slot:"userName"},{prop:"userType",label:c("system.user.userType"),minWidth:110,align:"center"},{prop:"creTime",label:c("system.user.creTime"),sortable:"custom",width:180,align:"center"},{prop:"state",label:c("system.user.state"),width:90,align:"center",sortable:"custom",slot:"state",formatter:s=>s.state==0?"正常":"冻结"},{columnKey:"action",label:c("system.user.action"),width:200,align:"center",slot:"action",hideInPrint:!0,hideInExport:!0}]),r=b([]),_=b(null),u=b(!1),d=({pages:s,where:l,orders:e})=>P({...l,...e,...s}),U=s=>{var l,e;r.value=[],(e=(l=y.value)==null?void 0:l.reload)==null||e.call(l,{page:1,where:s})},p=s=>{_.value=s!=null?s:null,u.value=!0},g=(s,l)=>{const e=s?1:0;he(l.id,e,l.account).then(o=>{l.state=e,w.success(o)}).catch(o=>{w.error(o.message)})},x=s=>{ie.prompt(`请输入用户"${s.account}"的新密码：`,"重置密码",{inputPattern:/^[\S]{5,18}$/,inputErrorMessage:"密码必须为5-18位非空白字符",draggable:!0}).then(({value:l})=>{const e=w.loading({message:"请求中..",plain:!0});xe(s.id,s==null?void 0:s.account,l).then(o=>{e.close(),w.success(o)}).catch(o=>{e.close(),w.error(o.message)})}).catch(()=>{})},E=({where:s,orders:l})=>P({...s,...l});return(s,l)=>{const e=F,o=pe,f=ge,k=ce,R=fe,S=_e,M=H;return C(),$(M,null,{default:a(()=>[t(S,{"body-style":{paddingTop:"8px"}},{toolbar:a(()=>[t(e,{type:"primary",class:"ele-btn-icon",icon:n(O),onClick:l[0]||(l[0]=m=>p())},{default:a(()=>[h(" 新建")]),_:1},8,["icon"])]),default:a(()=>[t(we,{ref_key:"searchRef",ref:v,style:{"margin-bottom":"-14px"},onSearch:U},null,512),t(R,{ref_key:"tableRef",ref:y,"row-key":"userId",columns:V.value,datasource:d,"show-overflow-tooltip":!0,border:!0,selections:r.value,"onUpdate:selections":l[2]||(l[2]=m=>r.value=m),"highlight-current-row":!0,"export-config":{fileName:"用户数据",datasource:E},"print-config":{datasource:E},"footer-style":{paddingBottom:"16px"},"cache-key":"systemUserTable"},{toolbar:a(()=>[t(e,{type:"primary",class:"ele-btn-icon",icon:n(O),onClick:l[1]||(l[1]=m=>p())},{default:a(()=>[h(" 新建")]),_:1},8,["icon"])]),userType:a(({row:m})=>[h(me(m.userType==1?"开启":"关闭"),1)]),state:a(({row:m})=>[t(o,{size:"small","model-value":m.state===1,onChange:T=>g(T,m)},null,8,["model-value","onChange"])]),action:a(({row:m})=>[t(f,{type:"primary",underline:!1,onClick:T=>p(m)},{default:a(()=>[h(" 修改")]),_:2},1032,["onClick"]),t(k,{direction:"vertical"}),t(f,{type:"warning",underline:!1,onClick:T=>x(m)},{default:a(()=>[h(" 修改密码")]),_:2},1032,["onClick"])]),_:1},8,["columns","selections","export-config","print-config"])]),_:1}),t(Ce,{data:_.value,modelValue:u.value,"onUpdate:modelValue":l[3]||(l[3]=m=>u.value=m),onDone:U},null,8,["data","modelValue"])]),_:1})}}});export{Ke as default};
