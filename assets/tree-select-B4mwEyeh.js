import{X as z,w as A,n as O,f3 as _,bJ as R,J as L,bz as x,K as k,d as I,I as p,b3 as B,dc as F,f4 as J,cL as U,b8 as X,eV as $,cj as D,r as H,b as M,a4 as G,bL as S,a1 as Q,a2 as W}from"./index-BiiIy8BH.js";import{E as T}from"./tree-BvQcSpbV.js";const Y=(e,{attrs:s,emit:i},{select:u,tree:n,key:a})=>{const o=z("tree-select");return A(()=>e.data,()=>{e.filterable&&O(()=>{var t,h;(h=n.value)==null||h.filter((t=u.value)==null?void 0:t.states.inputValue)})},{flush:"post"}),{..._(R(e),Object.keys(L.props)),...s,"onUpdate:modelValue":t=>i(x,t),valueKey:a,popperClass:k(()=>{const t=[o.e("popper")];return e.popperClass&&t.push(e.popperClass),t.join(" ")}),filterMethod:(t="")=>{var h;e.filterMethod?e.filterMethod(t):e.remoteMethod?e.remoteMethod(t):(h=n.value)==null||h.filter(t)}}},Z=I({extends:p,setup(e,s){const i=p.setup(e,s);delete i.selectOptionClick;const u=B().proxy;return O(()=>{i.select.states.cachedOptions.get(u.value)||i.select.onOptionCreate(u)}),A(()=>s.attrs.visible,n=>{i.states.visible=n},{immediate:!0}),i},methods:{selectOptionClick(){this.$el.parentElement.click()}}});function j(e){return e||e===0}function P(e){return Array.isArray(e)&&e.length}function K(e){return Array.isArray(e)?e:j(e)?[e]:[]}function V(e,s,i,u,n){for(let a=0;a<e.length;a++){const o=e[a];if(s(o,a,e,n))return u?u(o,a,e,n):o;{const C=i(o);if(P(C)){const t=V(C,s,i,u,o);if(t)return t}}}}function w(e,s,i,u){for(let n=0;n<e.length;n++){const a=e[n];s(a,n,e,u);const o=i(a);P(o)&&w(o,s,i,a)}}const ee=(e,{attrs:s,slots:i,emit:u},{select:n,tree:a,key:o})=>{A(()=>e.modelValue,()=>{e.showCheckbox&&O(()=>{const l=a.value;l&&!F(l.getCheckedKeys(),K(e.modelValue))&&l.setCheckedKeys(K(e.modelValue))})},{immediate:!0,deep:!0});const C=k(()=>({value:o.value,label:"label",children:"children",disabled:"disabled",isLeaf:"isLeaf",...e.props})),t=(l,c)=>{var d;const r=C.value[l];return U(r)?r(c,(d=a.value)==null?void 0:d.getNode(t("value",c))):c[r]},h=K(e.modelValue).map(l=>V(e.data||[],c=>t("value",c)===l,c=>t("children",c),(c,d,r,v)=>v&&t("value",v))).filter(l=>j(l)),g=k(()=>{if(!e.renderAfterExpand&&!e.lazy)return[];const l=[];return w(e.data.concat(e.cacheData),c=>{const d=t("value",c);l.push({value:d,currentLabel:t("label",c),isDisabled:t("disabled",c)})},c=>t("children",c)),l});return{..._(R(e),Object.keys(T.props)),...s,nodeKey:o,expandOnClickNode:k(()=>!e.checkStrictly&&e.expandOnClickNode),defaultExpandedKeys:k(()=>e.defaultExpandedKeys?e.defaultExpandedKeys.concat(h):h),renderContent:(l,{node:c,data:d,store:r})=>l(Z,{value:t("value",d),label:t("label",d),disabled:t("disabled",d),visible:c.visible},e.renderContent?()=>e.renderContent(l,{node:c,data:d,store:r}):i.default?()=>i.default({node:c,data:d,store:r}):void 0),filterNodeMethod:(l,c,d)=>e.filterNodeMethod?e.filterNodeMethod(l,c,d):l?new RegExp(J(l),"i").test(t("label",c)||""):!0,onNodeClick:(l,c,d)=>{var r,v,m,b;if((r=s.onNodeClick)==null||r.call(s,l,c,d),!(e.showCheckbox&&e.checkOnClickNode)){if(!e.showCheckbox&&(e.checkStrictly||c.isLeaf)){if(!t("disabled",l)){const N=(v=n.value)==null?void 0:v.states.options.get(t("value",l));(m=n.value)==null||m.handleOptionSelect(N)}}else e.expandOnClickNode&&d.proxy.handleExpandIconClick();(b=n.value)==null||b.focus()}},onCheck:(l,c)=>{var d;if(!e.showCheckbox)return;const r=t("value",l),v={};w([a.value.store.root],f=>v[f.key]=f,f=>f.childNodes);const m=c.checkedKeys,b=e.multiple?K(e.modelValue).filter(f=>!(f in v)&&!m.includes(f)):[],N=b.concat(m);if(e.checkStrictly)u(x,e.multiple?N:N.includes(r)?r:void 0);else if(e.multiple)u(x,b.concat(a.value.getCheckedKeys(!0)));else{const f=V([l],y=>!P(t("children",y))&&!t("disabled",y),y=>t("children",y)),E=f?t("value",f):void 0,q=j(e.modelValue)&&!!V([l],y=>t("value",y)===e.modelValue,y=>t("children",y));u(x,E===e.modelValue||q?void 0:E)}O(()=>{var f;const E=K(e.modelValue);a.value.setCheckedKeys(E),(f=s.onCheck)==null||f.call(s,l,{checkedKeys:a.value.getCheckedKeys(),checkedNodes:a.value.getCheckedNodes(),halfCheckedKeys:a.value.getHalfCheckedKeys(),halfCheckedNodes:a.value.getHalfCheckedNodes()})}),(d=n.value)==null||d.focus()},cacheOptions:g}};var te=I({props:{data:{type:Array,default:()=>[]}},setup(e){const s=X($);return A(()=>e.data,()=>{var i;e.data.forEach(n=>{s.states.cachedOptions.has(n.value)||s.states.cachedOptions.set(n.value,n)});const u=((i=s.selectRef)==null?void 0:i.querySelectorAll("input"))||[];D&&!Array.from(u).includes(document.activeElement)&&s.setSelected()},{flush:"post",immediate:!0}),()=>{}}});const le=I({name:"ElTreeSelect",inheritAttrs:!1,props:{...L.props,...T.props,cacheData:{type:Array,default:()=>[]}},setup(e,s){const{slots:i,expose:u}=s,n=H(),a=H(),o=k(()=>e.nodeKey||e.valueKey||"value"),C=Y(e,s,{select:n,tree:a,key:o}),{cacheOptions:t,...h}=ee(e,s,{select:n,tree:a,key:o}),g=M({});return u(g),G(()=>{Object.assign(g,{..._(a.value,["filter","updateKeyChildren","getCheckedNodes","setCheckedNodes","getCheckedKeys","setCheckedKeys","setChecked","getHalfCheckedNodes","getHalfCheckedKeys","getCurrentKey","getCurrentNode","setCurrentKey","setCurrentNode","getNode","remove","append","insertBefore","insertAfter"]),..._(n.value,["focus","blur"])})}),()=>S(L,M({...C,ref:l=>n.value=l}),{...i,default:()=>[S(te,{data:t.value}),S(T,M({...h,ref:l=>a.value=l}))]})}});var ne=Q(le,[["__file","tree-select.vue"]]);const se=W(ne);export{se as E};
